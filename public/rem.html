<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medication Reminder | SentinalMind</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="medical-styles.css" rel="stylesheet" />
    
    <style>
        .reminder-container {
            max-width: 800px;
            margin: 120px auto 50px;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            padding: 40px;
        }
        
        .reminder-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .reminder-header h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .reminder-form {
            margin-bottom: 30px;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .medication-list {
            margin-top: 40px;
        }
        
        .medication-list h3 {
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }
        
        .medication-list h3:after {
            content: '';
            position: absolute;
            width: 50px;
            height: 2px;
            background-color: var(--primary-color);
            left: 0;
            bottom: 0;
        }
        
        .medication-card {
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
    padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .medication-info {
            display: flex;
            align-items: center;
        }
        
        .medication-icon {
            width: 50px;
            height: 50px;
            background-color: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .medication-icon i {
            font-size: 24px;
            color: var(--primary-color);
        }
        
        .medication-details h4 {
            margin-bottom: 5px;
            font-size: 18px;
        }
        
        .medication-time {
            color: var(--text-light);
            display: flex;
            align-items: center;
        }
        
        .medication-time i {
            margin-right: 5px;
            color: var(--primary-color);
        }
        
        .medication-actions button {
            margin-left: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .dosage-instruction {
            color: var(--text-muted);
            font-size: 14px;
            margin-top: 5px;
        }
        
        .notification-badge {
            display: inline-block;
            background-color: var(--primary-light);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 50px;
            font-size: 14px;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        
        .notification-badge i {
            margin-right: 5px;
        }
        
        .back-to-home {
            display: block;
            text-align: center;
            margin-top: 30px;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 50px;
            color: var(--text-muted);
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3">
    <div class="container">
                <a class="navbar-brand" href="index.html">
                    <i class="bi bi-heart-pulse-fill me-2"></i>SentinalMind
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link" href="index.html#services">Services</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#doctors">Our Doctors</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#about">About Us</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html#contact">Contact</a></li>
                    </ul>
                    <a class="btn btn-sm btn-primary rounded-pill ms-lg-4" href="sign.html">
                        <i class="bi bi-person-fill me-1"></i>Sign In
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <div class="reminder-container">
        <div class="reminder-header">
            <h1>Medication Reminder</h1>
            <p>Never miss a dose with our medication reminder system</p>
            <span class="notification-badge"><i class="bi bi-bell-fill"></i> Notifications enabled</span>
        </div>
        
        <div class="reminder-form">
            <form id="medicationForm">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="medName" class="form-label">Medication Name</label>
                            <input type="text" class="form-control" id="medName" placeholder="Enter medication name" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="medTime" class="form-label">Reminder Time</label>
                            <input type="time" class="form-control" id="medTime" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="medDosage" class="form-label">Dosage</label>
                            <input type="text" class="form-control" id="medDosage" placeholder="e.g., 1 tablet, 10ml">
                            <div class="dosage-instruction">Specify quantity and unit</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="medFrequency" class="form-label">Frequency</label>
                            <select class="form-control" id="medFrequency">
                                <option value="once">Once</option>
                                <option value="daily">Daily</option>
                                <option value="twice">Twice Daily</option>
                                <option value="three">Three Times Daily</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="medNotes" class="form-label">Notes (Optional)</label>
                    <textarea class="form-control" id="medNotes" rows="2" placeholder="Additional instructions or notes"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-plus-circle me-2"></i>Add Medication Reminder
                </button>
            </form>
        </div>
        
        <div class="medication-list">
            <h3>Your Medication Schedule</h3>
            <div id="medicationContainer">
                <!-- Medication items will be added here dynamically -->
                <div class="empty-state" id="emptyState">
                    <i class="bi bi-calendar-x"></i>
                    <h4>No medications scheduled</h4>
                    <p>Add your first medication reminder above</p>
                </div>
            </div>
        </div>
        
        <a href="index.html" class="back-to-home">Back to Home</a>
    </div>

    <!-- Notification Modal -->
    <div class="modal fade" id="reminderModal" tabindex="-1" aria-labelledby="reminderModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="reminderModalLabel">Medication Reminder</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-alarm-fill text-primary" style="font-size: 48px;"></i>
                    </div>
                    <h4 class="text-center" id="modalMedName">Medication Name</h4>
                    <p class="text-center" id="modalMedDosage">Dosage information</p>
                    <p class="text-center text-muted" id="modalMedNotes">Additional notes</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Dismiss</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="takenButton">
                        <i class="bi bi-check-circle me-2"></i>Taken
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle & Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize medication array from local storage or empty array
        let medications = JSON.parse(localStorage.getItem('medications')) || [];
        
        // Initialize notification permission
        let notificationPermission = false;
        
        // DOM elements
        const medicationForm = document.getElementById('medicationForm');
        const medicationContainer = document.getElementById('medicationContainer');
        const emptyState = document.getElementById('emptyState');
        const reminderModal = new bootstrap.Modal(document.getElementById('reminderModal'));
        
        // Request notification permission on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Request notification permission
            if ('Notification' in window) {
                Notification.requestPermission().then(function(permission) {
                    notificationPermission = permission === 'granted';
                });
            }
            
            // Display existing medications
            renderMedications();
            
            // Set up timers for existing medications
            setupReminders();
        });
        
        // Add new medication
        medicationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
    const medName = document.getElementById('medName').value;
    const medTime = document.getElementById('medTime').value;
            const medDosage = document.getElementById('medDosage').value;
            const medFrequency = document.getElementById('medFrequency').value;
            const medNotes = document.getElementById('medNotes').value;
            
            // Generate a unique ID
            const medId = Date.now().toString();
            
            // Create medication object
            const medication = {
                id: medId,
                name: medName,
                time: medTime,
                dosage: medDosage,
                frequency: medFrequency,
                notes: medNotes,
                active: true,
                created: new Date().toISOString()
            };
            
            // Add to medications array
            medications.push(medication);
            
            // Save to local storage
            saveToLocalStorage();
            
            // Render the medications list
            renderMedications();
            
            // Set up reminder for this medication
            setupReminder(medication);
            
            // Reset form
            medicationForm.reset();
            
            // Show success message
            showToast(`Reminder for ${medName} set successfully!`);
        });
        
        // Render medications list
        function renderMedications() {
            // Sort medications by time
            medications.sort((a, b) => {
                return a.time.localeCompare(b.time);
            });
            
            // Check if there are medications
            if (medications.length === 0) {
                emptyState.style.display = 'block';
                medicationContainer.innerHTML = '';
                medicationContainer.appendChild(emptyState);
        return;
    }

            // Hide empty state
            emptyState.style.display = 'none';
            
            // Clear container
            medicationContainer.innerHTML = '';
            
            // Add each medication
            medications.forEach(med => {
                const medCard = document.createElement('div');
                medCard.className = 'medication-card';
                medCard.dataset.id = med.id;
                
                const displayTime = formatTime(med.time);
                let frequencyText = '';
                
                switch(med.frequency) {
                    case 'once': 
                        frequencyText = 'Once only';
                        break;
                    case 'daily': 
                        frequencyText = 'Daily';
                        break;
                    case 'twice': 
                        frequencyText = 'Twice daily';
                        break;
                    case 'three': 
                        frequencyText = 'Three times daily';
                        break;
                    case 'custom': 
                        frequencyText = 'Custom schedule';
                        break;
                }
                
                medCard.innerHTML = `
                    <div class="medication-info">
                        <div class="medication-icon">
                            <i class="bi bi-capsule"></i>
                        </div>
                        <div class="medication-details">
                            <h4>${med.name}</h4>
                            <div class="medication-time">
                                <i class="bi bi-clock"></i>
                                <span>${displayTime}</span>
                                <span class="badge bg-light text-dark ms-2">${frequencyText}</span>
                            </div>
                            ${med.dosage ? `<div class="dosage">${med.dosage}</div>` : ''}
                        </div>
                    </div>
                    <div class="medication-actions">
                        <button class="btn btn-sm btn-outline-primary edit-btn" data-id="${med.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${med.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                
                medicationContainer.appendChild(medCard);
                
                // Add event listeners for edit and delete buttons
                medCard.querySelector('.edit-btn').addEventListener('click', function() {
                    editMedication(med.id);
                });
                
                medCard.querySelector('.delete-btn').addEventListener('click', function() {
                    deleteMedication(med.id);
                });
            });
        }
        
        // Format time to 12-hour format
        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }
        
        // Set up reminders for all medications
        function setupReminders() {
            medications.forEach(med => {
                if (med.active) {
                    setupReminder(med);
                }
            });
        }
        
        // Set up a single reminder
        function setupReminder(medication) {
            // Calculate time until reminder
    const reminderTime = new Date();
            const [hours, minutes] = medication.time.split(':');
    reminderTime.setHours(hours);
    reminderTime.setMinutes(minutes);
    reminderTime.setSeconds(0);

    const now = new Date();
            let timeToReminder = reminderTime.getTime() - now.getTime();

            // If time is in the past, set for tomorrow
    if (timeToReminder < 0) {
                timeToReminder += 24 * 60 * 60 * 1000; // Add 24 hours
            }
            
            // Set timeout for reminder
            setTimeout(() => {
                triggerReminder(medication);
            }, timeToReminder);
        }
        
        // Trigger a reminder
        function triggerReminder(medication) {
            // Show notification if permission is granted
            if (notificationPermission) {
                const notification = new Notification('Medication Reminder', {
                    body: `Time to take ${medication.name}${medication.dosage ? ` - ${medication.dosage}` : ''}`,
                    icon: '/assets/img/favicons/favicon-32x32.png'
                });
                
                notification.onclick = function() {
                    window.focus();
                    showReminderModal(medication);
                };
            }
            
            // Show modal
            showReminderModal(medication);
            
            // Set up next reminder if it's recurring
            if (medication.frequency !== 'once') {
                // For recurring medications, set up the next reminder
                const nextReminder = new Date();
                nextReminder.setHours(nextReminder.getHours() + 24); // Next day

    setTimeout(() => {
                    triggerReminder(medication);
                }, 24 * 60 * 60 * 1000); // 24 hours
            }
        }
        
        // Show reminder modal
        function showReminderModal(medication) {
            document.getElementById('modalMedName').textContent = medication.name;
            document.getElementById('modalMedDosage').textContent = medication.dosage || 'Take as prescribed';
            document.getElementById('modalMedNotes').textContent = medication.notes || 'No additional notes';
            
            // Show the modal
            reminderModal.show();
            
            // Play sound
            playReminderSound();
        }
        
        // Play reminder sound
        function playReminderSound() {
            const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
            audio.play();
        }
        
        // Save medications to local storage
        function saveToLocalStorage() {
            localStorage.setItem('medications', JSON.stringify(medications));
        }
        
        // Delete a medication
        function deleteMedication(id) {
            if (confirm('Are you sure you want to delete this medication reminder?')) {
                medications = medications.filter(med => med.id !== id);
                saveToLocalStorage();
                renderMedications();
            }
        }
        
        // Edit a medication
        function editMedication(id) {
            const medication = medications.find(med => med.id === id);
            
            if (medication) {
                document.getElementById('medName').value = medication.name;
                document.getElementById('medTime').value = medication.time;
                document.getElementById('medDosage').value = medication.dosage || '';
                document.getElementById('medFrequency').value = medication.frequency;
                document.getElementById('medNotes').value = medication.notes || '';
                
                // Remove the old medication
                medications = medications.filter(med => med.id !== id);
                saveToLocalStorage();
                renderMedications();
                
                // Scroll to form
                medicationForm.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Show a toast message
        function showToast(message) {
            // Check if toasts container exists, if not create it
            let toastsContainer = document.querySelector('.toast-container');
            
            if (!toastsContainer) {
                toastsContainer = document.createElement('div');
                toastsContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastsContainer);
            }
            
            // Create toast
            const toastEl = document.createElement('div');
            toastEl.className = 'toast align-items-center text-white bg-primary border-0';
            toastEl.setAttribute('role', 'alert');
            toastEl.setAttribute('aria-live', 'assertive');
            toastEl.setAttribute('aria-atomic', 'true');
            
            toastEl.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            toastsContainer.appendChild(toastEl);
            
            // Initialize and show toast
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
            
            // Remove toast after it's hidden
            toastEl.addEventListener('hidden.bs.toast', function() {
                toastEl.remove();
            });
        }
        
        // Handle "Taken" button click
        document.getElementById('takenButton').addEventListener('click', function() {
            showToast('Medication marked as taken! Great job staying on track with your health.');
        });
    </script>
</body>
</html>
